<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MEHTA TOSS BOOK DASHBOARD</title>
<style>
    body {
        background:#111;
        color:#eee;
        font-family: "Segoe UI", sans-serif;
        padding:10px;
    }
    h2 {
        font-size:18px;
        background:#222;
        padding:8px;
        border-left:3px solid #00aaff;
    }
    input, select {
        width:100%;
        padding:7px;
        margin:4px 0;
        background:#1e1e1e;
        color:white;
        border:1px solid #333;
    }
    button {
        width:100%;
        padding:8px;
        margin-top:5px;
        background:#0088ff;
        color:white;
        border:none;
        border-radius:4px;
        font-weight:bold;
    }
    button.red { background:#d13f3f; }
    button.gold { background:#daa520; }
    textarea {
        width:100%;
        height:200px;
        background:#000;
        color:#0f0;
        padding:10px;
        margin-top:10px;
    }
    .box {
        margin-bottom:20px;
        padding:10px;
        background:#181818;
        border:1px solid #333;
    }
    .msg { color:#0f0; font-size:13px; margin-top:3px; }
</style>
</head>

<body>

<h1>üìñ MEHTA TOSS BOOK DASHBOARD</h1>

<!-- PLAYER SECTION -->
<div class="box">
    <h2>‚ûï Add Player</h2>
    <input id="add_name" placeholder="Player Name">
    <input id="add_dp" placeholder="DP Number">
    <input id="add_open" placeholder="Opening Balance">
    <button id="addPlayerBtn">ADD PLAYER</button>
    <div id="addOutput" class="msg"></div>
</div>

<div class="box">
    <h2>‚ûñ Remove Player</h2>
    <select id="removeSelect"></select>
    <button id="removePlayerBtn" class="red">REMOVE PLAYER</button>
    <div id="removeOutput" class="msg"></div>
</div>

<div class="box">
    <h2>üí∞ Balance Update</h2>
    <input id="balDP" placeholder="DP Number">
    <input id="balAmount" placeholder="Amount (+ / -)">
    <button id="updateBalBtn" class="gold">UPDATE BALANCE</button>
    <div id="balanceOutput" class="msg"></div>
</div>

<!-- MATCH SECTION -->
<div class="box">
    <h2>üéÆ Create Match</h2>
    <input id="league" placeholder="League Name (optional)">
    <input id="teamA" placeholder="Team A">
    <input id="teamB" placeholder="Team B">
    <input id="oddsA" placeholder="Odds Team A (like 0.95)">
    <input id="oddsB" placeholder="Odds Team B (like 0.97)">
    <button id="createMatchBtn">CREATE MATCH</button>
    <div id="createMatchOutput" class="msg"></div>
</div>

<!-- BET SECTION -->
<div class="box">
    <h2>üèè Place Bet</h2>
    <input id="betMatchId" placeholder="Match ID">
    <input id="betDP" placeholder="DP Number">
    <input id="betTeam" placeholder="Team Name">
    <input id="betStake" placeholder="Stake Amount">
    <input id="betOdds" placeholder="Odds">
    <button id="placeBetBtn">PLACE BET</button>
    <div id="betOutput" class="msg"></div>
</div>

<!-- SETTLE -->
<div class="box">
    <h2>‚úîÔ∏è Settle Match</h2>
    <input id="settleMatchId" placeholder="Match ID">
    <input id="settleWinner" placeholder="Winner Team">
    <button id="settleBtn" class="gold">SETTLE MATCH</button>
    <div id="settleOutput" class="msg"></div>
</div>

<!-- VOID -->
<div class="box">
    <h2>üö´ Void Match</h2>
    <input id="voidMatchId" placeholder="Match ID">
    <button id="voidBtn" class="red">VOID MATCH</button>
    <div id="voidOutput" class="msg"></div>
</div>

<!-- DP LIST -->
<div class="box">
    <h2>üìã DP LIST</h2>
    <button id="loadDpBtn">LOAD DP LIST</button>
    <button id="copyDpBtn" class="gold">COPY LIST</button>
    <textarea id="dpList"></textarea>
</div>




<script>
/* --------------------
CONFIG
-------------------- */
const API_URL = "https://script.google.com/macros/s/AKfycbw5RVnOu6Aoij6Q41s6PBSMjg0cF4ZaEuqKrUIJj1p-Ccl0c0V3VMHcIk-PZjl9NnAm/exec";

/* quick api helper */
async function api(action, data={}){
    data.action = action;
    try {
        const res = await fetch(API_URL, {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify(data)
        });
        return await res.json();
    } catch(err){
        return { success:false, error:String(err) };
    }
}

/* --------------------
PLAYER FUNCTIONS
-------------------- */
document.getElementById("addPlayerBtn").onclick = async()=>{
    const res = await api("addPlayer",{
        name: add_name.value,
        dp: add_dp.value,
        opening: add_open.value
    });
    addOutput.textContent = res.success ? "Player Added ‚úì" : res.error;
    loadPlayers();
};

document.getElementById("removePlayerBtn").onclick = async()=>{
    const dp = removeSelect.value;
    if(!dp){ alert("Select DP"); return; }
    const res = await api("removePlayer",{ dp });
    removeOutput.textContent = res.success ? "Player Removed ‚úì" : res.error;
    loadPlayers();
};

document.getElementById("updateBalBtn").onclick = async()=>{
    const res = await api("updateBalance",{
        dp: balDP.value,
        amount: Number(balAmount.value)
    });
    balanceOutput.textContent = res.success ? "Updated ‚úì": res.error;
    loadPlayers();
};

/* --------------------
MATCH FUNCTIONS
-------------------- */
createMatchBtn.onclick = async()=>{
    const res = await api("createMatch",{
        league: league.value,
        teamA: teamA.value,
        teamB: teamB.value,
        oddsA: oddsA.value,
        oddsB: oddsB.value
    });
    createMatchOutput.textContent = res.success ? ("Match Created ID: "+res.matchId) : res.error;
};

/* --------------------
BET FUNCTIONS
-------------------- */
placeBetBtn.onclick = async()=>{
    const res = await api("addBet",{
        matchId: betMatchId.value,
        playerDp: betDP.value,
        team: betTeam.value,
        stake: betStake.value,
        odds: betOdds.value
    });
    betOutput.textContent = res.success ? "Bet Placed ‚úì" : res.error;
};

/* --------------------
SETTLE MATCH
-------------------- */
settleBtn.onclick = async()=>{
    const res = await api("settleMatch",{
        matchId: settleMatchId.value,
        winner: settleWinner.value
    });
    settleOutput.textContent = res.success ? "Settled ‚úì" : res.error;
    loadPlayers();
};

/* --------------------
VOID MATCH
-------------------- */
voidBtn.onclick = async()=>{
    const res = await api("voidMatch",{ matchId: voidMatchId.value });
    voidOutput.textContent = res.success ? "Match Voided ‚úì" : res.error;
};

/* --------------------
LOAD DP LIST
-------------------- */
loadDpBtn.onclick = loadPlayers;

copyDpBtn.onclick = ()=>{
    navigator.clipboard.writeText(dpList.value);
    alert("Copied ‚úì");
};

async function loadPlayers(){
    const res = await api("getPlayers",{});
    if(!res.success){ dpList.value="Failed to load"; return; }

    let rows = res.players;
    if(rows.length && rows[0][0].toLowerCase() === "dp") rows = rows.slice(1);

    removeSelect.innerHTML = `<option value="">Select DP</option>`;

    let txt = "üìñ MEHTA TOSS BOOK DP LIST\n" + new Date().toLocaleString() + "\n\n";

    rows.forEach((r,i)=>{
        const dp = r[0];
        const name = r[1];
        const bal = r[2];
        txt += `${i+1}) ${name} ‚Äî ${dp} ‚Äî ‚Çπ${bal}\n`;

        removeSelect.insertAdjacentHTML("beforeend",
            `<option value="${dp}">${name} ‚Äî ${dp} ‚Äî ‚Çπ${bal}</option>`
        );
    });

    txt += `\nTotal Players: ${rows.length}`;
    dpList.value = txt;
}

/* load on start */
loadPlayers();

</script>

</body>
</html>
