<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MEHTA TOSS BOOK ðŸ“–</title>
<style>
body{font-family:sans-serif;background:#f3f5f7;color:#111;margin:0;padding:0}
.wrap{max-width:900px;margin:auto;padding:16px}
.card{background:#fff;padding:12px;margin-bottom:12px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
input,select,button{padding:8px;margin:4px 0;width:100%;border-radius:6px;border:1px solid #ccc}
button{background:#1d9bf0;color:#fff;border:none;cursor:pointer}
button.ghost{background:#fff;border:1px solid #1d9bf0;color:#1d9bf0}
.dp-area{white-space:pre-wrap;background:#fff;padding:8px;border:1px solid #ccc;border-radius:6px;min-height:80px;font-family:monospace}
.flex{display:flex;gap:6px;align-items:center}
</style>
</head>
<body>
<div class="wrap">
<h2>MEHTA TOSS BOOK ðŸ“–</h2>

<div class="card">
<strong>Create Match</strong>
<input id="league" placeholder="League">
<input id="teamA" placeholder="Team A">
<input id="teamB" placeholder="Team B">
<select id="oddsA"><option>2.0</option><option>0.95</option><option>0.97</option><option>0.98</option></select>
<select id="oddsB"><option>2.0</option><option>0.95</option><option>0.97</option><option>0.98</option></select>
<button onclick="createMatch()">Create Match</button>
<div id="matchOutput"></div>
</div>

<div class="card">
<strong>Active Matches</strong>
<select id="matchSelect"></select>
<select id="winnerSelect"></select>
<div class="flex">
<button onclick="settleMatch()">Settle Match</button>
<button onclick="voidMatch()">Void Match</button>
</div>
<div id="settleOutput"></div>
</div>

<div class="card">
<strong>Add Player</strong>
<input id="add_name" placeholder="Player Name">
<input id="add_dp" placeholder="DP Number">
<input id="add_open" placeholder="Opening Balance" type="number">
<button onclick="addPlayer()">Add Player</button>
<div id="addOutput"></div>
</div>

<div class="card">
<strong>Place Bet</strong>
<select id="betMatchSelect"></select>
<select id="betTeam"></select>
<select id="betOdds"></select>
<input id="dpNumber" placeholder="DP Number">
<input id="betAmount" placeholder="Stake" type="number">
<button onclick="placeBet()">Place Bet</button>
<div id="betOutput"></div>
</div>

<div class="card">
<strong>DP List</strong>
<button onclick="copyDPList()">Copy DP List</button>
<div id="dpList" class="dp-area">Loading...</div>
</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwK0Tyi84yRpO4FB8IrK2H5YP1ifT2OwmpWxFqnosInVFpYhoNqy-8DjbwKFdk0s1AJ/exec"; // <-- Replace with your Apps Script URL

let matches=[],players={};

async function call(action,payload={}){payload.action=action;
try{const r=await fetch(API_URL,{method:'POST',headers:{"Content-Type":"application/json"},body:JSON.stringify(payload),mode:'cors',credentials:'omit'});return await r.json();}catch(e){return {success:false,error:e.message}}
}

function showMsg(msg,id,time=1500){document.getElementById(id).innerText=msg;setTimeout(()=>document.getElementById(id).innerText="",time)}

async function loadPlayers(){const r=await call("getPlayers");players={};if(r.success){r.players.forEach(p=>players[String(p[0])]={name:p[1],balance:p[2]});}renderDPList();}

async function loadMatches(){const r=await call("getMatches");matches=[];const sel=document.getElementById("matchSelect"),bet=document.getElementById("betMatchSelect");sel.innerHTML="";bet.innerHTML="";if(r.success){matches=r.matches;matches.forEach(m=>{sel.insertAdjacentHTML('beforeend',`<option value="${m[0]}">${m[2]} vs ${m[3]} (${m[1]}) [${m[6]}]</option>`);bet.insertAdjacentHTML('beforeend',`<option value="${m[0]}">${m[2]} vs ${m[3]}</option>`);});updateWinnerSelect();updateBetTeam();}}

function updateWinnerSelect(){const sel=document.getElementById("matchSelect"),win=document.getElementById("winnerSelect");const m=matches.find(x=>x[0]==sel.value);win.innerHTML="";if(m){win.innerHTML=`<option>${m[2]}</option><option>${m[3]}</option>`;}}

function updateBetTeam(){const sel=document.getElementById("betMatchSelect"),team=document.getElementById("betTeam"),odds=document.getElementById("betOdds");const m=matches.find(x=>x[0]==sel.value);team.innerHTML="";if(m){team.innerHTML=`<option value="${m[2]}">${m[2]}</option><option value="${m[3]}">${m[3]}</option>`;odds.value=m[4];}}

document.getElementById("matchSelect").addEventListener("change",updateWinnerSelect);
document.getElementById("betMatchSelect").addEventListener("change",updateBetTeam);

async function createMatch(){const league=document.getElementById("league").value,teamA=document.getElementById("teamA").value,teamB=document.getElementById("teamB").value,oddsA=document.getElementById("oddsA").value,oddsB=document.getElementById("oddsB").value;if(!teamA||!teamB){alert("Enter both teams");return;}const r=await call("createMatch",{league,teamA,teamB,oddsA,oddsB});r.success? (showMsg(`Created ID:${r.matchId}`,"matchOutput",2000),loadMatches()):showMsg("Failed:"+r.error,"matchOutput",3000);}

async function addPlayer(){const name=document.getElementById("add_name").value,dp=document.getElementById("add_dp").value,opening=Number(document.getElementById("add_open").value||0);if(!dp){alert("DP required");return;}const r=await call("addPlayer",{name,dp,opening});r.success? (showMsg("Player added","addOutput",2000),loadPlayers()):showMsg("Failed:"+r.error,"addOutput",3000);}

async function placeBet(){const dp=document.getElementById("dpNumber").value,matchId=document.getElementById("betMatchSelect").value,team=document.getElementById("betTeam").value,stake=Number(document.getElementById("betAmount").value),odds=Number(document.getElementById("betOdds").value);if(!dp||!matchId||!team||!stake){alert("Fill all");return;}const r=await call("placeBet",{dp,matchId,team,stake,odds});r.success? showMsg("Bet placed","betOutput",2000):showMsg("Failed:"+r.error,"betOutput",3000);}

async function settleMatch(){const matchId=document.getElementById("matchSelect").value,winner=document.getElementById("winnerSelect").value;if(!matchId||!winner){alert("Select match/winner");return;}if(!confirm("Settle?"))return;const r=await call("settleMatch",{matchId,winner});r.success? (showMsg("Settled","settleOutput",2000),loadPlayers(),loadMatches()):showMsg("Failed:"+r.error,"settleOutput",3000);}

async function voidMatch(){const matchId=document.getElementById("matchSelect").value;if(!matchId){alert("Select match");return;}if(!confirm("Void match?"))return;const r=await call("voidMatch",{matchId});r.success? (showMsg("Voided","settleOutput",2000),loadMatches()):showMsg("Failed:"+r.error,"settleOutput",3000);}

function renderDPList(){const area=document.getElementById("dpList");let out=`MEHTA TOSS BOOK DP LIST\n\n`;Object.keys(players).sort((a,b)=>a-b).forEach((k,i)=>{const p=players[k];out+=`${i+1}) ${p.name} â€” ${k} â€” â‚¹${p.balance}\n`;});area.innerText=out;}
function copyDPList(){navigator.clipboard.writeText(document.getElementById("dpList").innerText).then(()=>alert("Copied"));}

window.addEventListener('load',()=>{loadPlayers();loadMatches();});
</script>
</body>
</html>
